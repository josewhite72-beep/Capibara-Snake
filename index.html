
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Capibara Snake</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #f0f8ff;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background-color: #fff;
      border: 3px solid #8b4513;
      margin-top: 20px;
    }
    #startScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    #startScreen img {
      max-width: 80%;
      margin-bottom: 20px;
    }
    #startScreen button {
      font-size: 24px;
      padding: 10px 20px;
      background-color: #8b4513;
      color: white;
      border: none;
      border-radius: 10px;
    }
    #controls {
      position: absolute;
      top: 100px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .control-row {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .control-row button {
      width: 50px;
      height: 50px;
      font-size: 20px;
      border-radius: 10px;
      background-color: #ffe4b5;
      border: 2px solid #8b4513;
    }
    #volumeControl, #speedControl {
      display: flex;
      gap: 5px;
      justify-content: center;
      margin-top: 10px;
    }
    #bullymeterContainer {
      position: relative;
      margin: 20px auto 0 auto;
      width: 160px;
      height: 100px;
      border: 2px solid #8b0000;
      background-color: rgba(255,255,255,0.2);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #bullymeterCount {
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      background-color: #8b0000;
      width: 100%;
      text-align: center;
      padding: 4px 0;
    }
    #bullymeterFill {
      flex-grow: 1;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      padding: 5px;
    }
    #bullyName {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background-color: red;
      color: white;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 0 0 10px 10px;
      display: none;
      z-index: 5;
    }
  </style>
</head>
<body>
<div id="startScreen">
  <img src="brigada_capibara_logo.png" alt="Brigada Capibara">
  <button onclick="startGame()">üéÆ Iniciar Juego</button>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>
<div id="bullyName">‚ö†Ô∏è Bully</div>

<div id="controls">
  <div class="control-row">
    <button onclick="setDirection(0, -1)">‚¨ÜÔ∏è</button>
  </div>
  <div class="control-row">
    <button onclick="setDirection(-1, 0)">‚¨ÖÔ∏è</button>
    <button onclick="setDirection(1, 0)">‚û°Ô∏è</button>
  </div>
  <div class="control-row">
    <button onclick="setDirection(0, 1)">‚¨áÔ∏è</button>
  </div>
  <div id="volumeControl">
    <button onclick="adjustVolume(-0.1)">-</button>
    <button onclick="setVolume(0)">0</button>
    <button onclick="adjustVolume(0.1)">+</button>
  </div>
  <div id="speedControl">
    <label for="speed">Velocidad:</label>
    <select id="speed" onchange="changeSpeed()">
      <option value="200">Lento</option>
      <option value="150" selected>Medio</option>
      <option value="100">R√°pido</option>
    </select>
  </div>
</div>

<div id="bullymeterContainer">
  <div id="bullymeterCount">
    <div>Canicas: <span id="canicasContador">0</span></div>
    <div>Tiempo: <span id="timer">03:00</span></div>
  </div>
  <div id="bullymeterFill"></div>
</div>

<audio id="backgroundMusic" src="background_music.mp3" loop></audio>
<audio id="popSound" src="pop.mp3"></audio>
<audio id="boingSound" src="boing.mp3"></audio>
<audio id="triumphSound" src="triumph.mp3"></audio>
<audio id="stepSound" src="step.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let capibara = [{x: 200, y: 200}];
let direction = {x: 0, y: 0};
let canicas = [];
let obstacles = [];
let score = 0;
let gameOver = false;
let hue = 0;
let bullyNames = ["Bully-blast", "Bully-word", "Bully-byte", "Bullyshade", "Bully-fear", "Bullymaster"];
let bullyNameDiv = document.getElementById("bullyName");
let gameSpeed = 150;
let timer = 180;
let bullymeterCount = 0;

function updateTimerDisplay() {
  const minutes = Math.floor(timer / 60);
  const seconds = timer % 60;
  document.getElementById("timer").textContent =
    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function startGame() {
  document.getElementById("startScreen").style.display = "none";
  document.getElementById("backgroundMusic").play();
  resetGame();
  gameLoop();
  updateTimerDisplay();
  setInterval(() => {
    timer--;
    updateTimerDisplay();
    if (timer <= 0) {
      alert("‚è≥ ¬°Tiempo terminado!");
      resetGame();
    }
  }, 1000);
}

function setDirection(x, y) {
  direction = {x, y};
  document.getElementById("stepSound").play();
}

function adjustVolume(delta) {
  let audio = document.getElementById("backgroundMusic");
  audio.volume = Math.min(1, Math.max(0, audio.volume + delta));
}
function setVolume(val) {
  document.getElementById("backgroundMusic").volume = val;
}

function changeSpeed() {
  gameSpeed = parseInt(document.getElementById("speed").value);
}

function spawnCanicas() {
  canicas = [];
  for (let i = 0; i < 10; i++) {
    canicas.push({
      x: Math.floor(Math.random() * canvas.width / 20) * 20,
      y: Math.floor(Math.random() * canvas.height / 20) * 20
    });
  }
}

function spawnObstacles() {
  obstacles = [];
  for (let i = 0; i < 6; i++) {
    obstacles.push({
      x: Math.floor(Math.random() * canvas.width / 20) * 20,
      y: Math.floor(Math.random() * canvas.height / 20) * 20,
      dx: i % 2 === 0 ? 1 : 0,
      dy: i % 2 === 0 ? 0 : 1,
      name: bullyNames[i],
      sprite: `bully${i}.png`
    });
  }
}

function resetGame() {
  capibara = [{x: 200, y: 200}];
  direction = {x: 0, y: 0};
  score = 0;
  bullymeterCount = 0;
  document.getElementById("canicasContador").textContent = "0";
  document.getElementById("bullymeterFill").innerHTML = "";
  spawnCanicas();
  spawnObstacles();
  gameOver = false;
  timer = 180;
  updateTimerDisplay();
}

function agregarCanicaAlBullymetro() {
  const fill = document.getElementById("bullymeterFill");
  const count = document.getElementById("canicasContador");

  const canica = document.createElement("div");
  canica.style.width = "20px";
  canica.style.height = "20px";
  canica.style.borderRadius = "50%";
  canica.style.margin = "2px";
  canica.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
  fill.appendChild(canica);

  bullymeterCount++;
  count.textContent = bullymeterCount;

  document.getElementById("boingSound").play();

  if (bullymeterCount >= 6) {
    document.getElementById("triumphSound").play();
    document.getElementById("bullymeterContainer").style.boxShadow = "0 0 10px 5px yellow";
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  let img = new Image();
  img.src = "capibara_sprite.png";
  ctx.drawImage(img, capibara[0].x, capibara[0].y, 20, 20);

  hue += 5;
  canicas.forEach(c => {
    ctx.fillStyle = `hsl(${hue % 360}, 100%, 50%)`;
    ctx.beginPath();
    ctx.arc(c.x + 10, c.y + 10, 8, 0, Math.PI * 2);
    ctx.fill();
  });

  obstacles.forEach((o, i) => {
    let bullyImg = new Image();
    bullyImg.src = o.sprite;
    ctx.drawImage(bullyImg, o.x, o.y, 20, 20);
  });
}

function update() {
  if (gameOver) return;

  const head = {x: capibara[0].x + direction.x * 20, y: capibara[0].y + direction.y * 20};

  if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
    alert("¬°Chocaste con el borde!");
    resetGame();
    return;
  }

  for (let o of obstacles) {
    if (head.x === o.x && head.y === o.y) {
      alert("¬°Chocaste con un Bully!");
      resetGame();
      return;
    }
    if (Math.abs(head.x - o.x) < 20 && Math.abs(head.y - o.y) < 20) {
      bullyNameDiv.textContent = `‚ö†Ô∏è ${o.name}`;
      bullyNameDiv.style.display = "block";
    }
  }

  setTimeout(() => {
    bullyNameDiv.style.display = "none";
  }, 1000);

  for (let i = 0; i < canicas.length; i++) {
    if (head.x === canicas[i].x && head.y === canicas[i].y) {
      score++;
      canicas.splice(i, 1);
      document.getElementById("popSound").play();
      agregarCanicaAlBullymetro();
      break;
    }
  }

  capibara.unshift(head);
  capibara.pop();
}

function moveObstacles() {
  obstacles.forEach(o => {
    o.x += o.dx * 20;
    o.y += o.dy * 20;
    if (o.x < 0 || o.x >= canvas.width) o.dx *= -1;
    if (o.y < 0 || o.y >= canvas.height) o.dy *= -1;
  });
}

function gameLoop() {
  update();
  draw();
  moveObstacles();
  setTimeout(gameLoop, gameSpeed);
}

document.addEventListener("keydown", function (e) {
  if (e.key === "ArrowUp") setDirection(0, -1);
  if (e.key === "ArrowDown") setDirection(0, 1);
  if (e.key === "ArrowLeft") setDirection(-1, 0);
  if (e.key === "ArrowRight") setDirection(1, 0);
});
</script>
</body>
</html>
